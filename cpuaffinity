#include <stdio.h>
#include <stdlib.h>
#include <sched.h>

int main(int argc, char * argv[]) {

  pid_t pid;
  long new_mask;
  long current_mask;
  int len = sizeof(new_mask);

  pid = atol(argv[1]);
  scanf(argv[2], "%lx", &new_mask);

  if (sched_getaffinity(pid, len, &current_mask) < 0) {
      printf("Could not get %d's affinity.\n\n", pid);
      return -1;
  }

  printf("\n%d's old affinity: %lx\n\n", pid, current_mask);

  if (sched_setaffinity(pid, len, &new_mask)<0) {
        printf("Could not set %d's affinity.\n\n", pid);
        return -1;
  }

  if (sched_getaffinity(pid, len, &current_mask) < 0) {
        printf("Could not get %d's affinity.\n\n", pid);
        return -1;
  }

  printf("%d's new affinity: %lx\n\n", pid, current_mask);
  return 0;
}
